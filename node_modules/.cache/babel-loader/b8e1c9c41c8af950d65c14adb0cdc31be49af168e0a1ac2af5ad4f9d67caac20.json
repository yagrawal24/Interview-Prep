{"ast":null,"code":"exports.createBodyReader = createBodyReader;\nexports._readNumberingProperties = readNumberingProperties;\nvar dingbatToUnicode = require(\"dingbat-to-unicode\");\nvar _ = require(\"underscore\");\nvar documents = require(\"../documents\");\nvar Result = require(\"../results\").Result;\nvar warning = require(\"../results\").warning;\nvar uris = require(\"./uris\");\nfunction createBodyReader(options) {\n  return {\n    readXmlElement: function (element) {\n      return new BodyReader(options).readXmlElement(element);\n    },\n    readXmlElements: function (elements) {\n      return new BodyReader(options).readXmlElements(elements);\n    }\n  };\n}\nfunction BodyReader(options) {\n  var complexFieldStack = [];\n  var currentInstrText = [];\n\n  // When a paragraph is marked as deleted, its contents should be combined\n  // with the following paragraph. See 17.13.5.15 del (Deleted Paragraph) of\n  // ECMA-376 4th edition Part 1.\n  var deletedParagraphContents = [];\n  var relationships = options.relationships;\n  var contentTypes = options.contentTypes;\n  var docxFile = options.docxFile;\n  var files = options.files;\n  var numbering = options.numbering;\n  var styles = options.styles;\n  function readXmlElements(elements) {\n    var results = elements.map(readXmlElement);\n    return combineResults(results);\n  }\n  function readXmlElement(element) {\n    if (element.type === \"element\") {\n      var handler = xmlElementReaders[element.name];\n      if (handler) {\n        return handler(element);\n      } else if (!Object.prototype.hasOwnProperty.call(ignoreElements, element.name)) {\n        var message = warning(\"An unrecognised element was ignored: \" + element.name);\n        return emptyResultWithMessages([message]);\n      }\n    }\n    return emptyResult();\n  }\n  function readParagraphProperties(element) {\n    return readParagraphStyle(element).map(function (style) {\n      return {\n        type: \"paragraphProperties\",\n        styleId: style.styleId,\n        styleName: style.name,\n        alignment: element.firstOrEmpty(\"w:jc\").attributes[\"w:val\"],\n        numbering: readNumberingProperties(style.styleId, element.firstOrEmpty(\"w:numPr\"), numbering),\n        indent: readParagraphIndent(element.firstOrEmpty(\"w:ind\"))\n      };\n    });\n  }\n  function readParagraphIndent(element) {\n    return {\n      start: element.attributes[\"w:start\"] || element.attributes[\"w:left\"],\n      end: element.attributes[\"w:end\"] || element.attributes[\"w:right\"],\n      firstLine: element.attributes[\"w:firstLine\"],\n      hanging: element.attributes[\"w:hanging\"]\n    };\n  }\n  function readRunProperties(element) {\n    return readRunStyle(element).map(function (style) {\n      var fontSizeString = element.firstOrEmpty(\"w:sz\").attributes[\"w:val\"];\n      // w:sz gives the font size in half points, so halve the value to get the size in points\n      var fontSize = /^[0-9]+$/.test(fontSizeString) ? parseInt(fontSizeString, 10) / 2 : null;\n      return {\n        type: \"runProperties\",\n        styleId: style.styleId,\n        styleName: style.name,\n        verticalAlignment: element.firstOrEmpty(\"w:vertAlign\").attributes[\"w:val\"],\n        font: element.firstOrEmpty(\"w:rFonts\").attributes[\"w:ascii\"],\n        fontSize: fontSize,\n        isBold: readBooleanElement(element.first(\"w:b\")),\n        isUnderline: readUnderline(element.first(\"w:u\")),\n        isItalic: readBooleanElement(element.first(\"w:i\")),\n        isStrikethrough: readBooleanElement(element.first(\"w:strike\")),\n        isAllCaps: readBooleanElement(element.first(\"w:caps\")),\n        isSmallCaps: readBooleanElement(element.first(\"w:smallCaps\"))\n      };\n    });\n  }\n  function readUnderline(element) {\n    if (element) {\n      var value = element.attributes[\"w:val\"];\n      return value !== undefined && value !== \"false\" && value !== \"0\" && value !== \"none\";\n    } else {\n      return false;\n    }\n  }\n  function readBooleanElement(element) {\n    if (element) {\n      var value = element.attributes[\"w:val\"];\n      return value !== \"false\" && value !== \"0\";\n    } else {\n      return false;\n    }\n  }\n  function readParagraphStyle(element) {\n    return readStyle(element, \"w:pStyle\", \"Paragraph\", styles.findParagraphStyleById);\n  }\n  function readRunStyle(element) {\n    return readStyle(element, \"w:rStyle\", \"Run\", styles.findCharacterStyleById);\n  }\n  function readTableStyle(element) {\n    return readStyle(element, \"w:tblStyle\", \"Table\", styles.findTableStyleById);\n  }\n  function readStyle(element, styleTagName, styleType, findStyleById) {\n    var messages = [];\n    var styleElement = element.first(styleTagName);\n    var styleId = null;\n    var name = null;\n    if (styleElement) {\n      styleId = styleElement.attributes[\"w:val\"];\n      if (styleId) {\n        var style = findStyleById(styleId);\n        if (style) {\n          name = style.name;\n        } else {\n          messages.push(undefinedStyleWarning(styleType, styleId));\n        }\n      }\n    }\n    return elementResultWithMessages({\n      styleId: styleId,\n      name: name\n    }, messages);\n  }\n  var unknownComplexField = {\n    type: \"unknown\"\n  };\n  function readFldChar(element) {\n    var type = element.attributes[\"w:fldCharType\"];\n    if (type === \"begin\") {\n      complexFieldStack.push(unknownComplexField);\n      currentInstrText = [];\n    } else if (type === \"end\") {\n      complexFieldStack.pop();\n    } else if (type === \"separate\") {\n      var hyperlinkOptions = parseHyperlinkFieldCode(currentInstrText.join(''));\n      var complexField = hyperlinkOptions === null ? unknownComplexField : {\n        type: \"hyperlink\",\n        options: hyperlinkOptions\n      };\n      complexFieldStack.pop();\n      complexFieldStack.push(complexField);\n    }\n    return emptyResult();\n  }\n  function currentHyperlinkOptions() {\n    var topHyperlink = _.last(complexFieldStack.filter(function (complexField) {\n      return complexField.type === \"hyperlink\";\n    }));\n    return topHyperlink ? topHyperlink.options : null;\n  }\n  function parseHyperlinkFieldCode(code) {\n    var externalLinkResult = /\\s*HYPERLINK \"(.*)\"/.exec(code);\n    if (externalLinkResult) {\n      return {\n        href: externalLinkResult[1]\n      };\n    }\n    var internalLinkResult = /\\s*HYPERLINK\\s+\\\\l\\s+\"(.*)\"/.exec(code);\n    if (internalLinkResult) {\n      return {\n        anchor: internalLinkResult[1]\n      };\n    }\n    return null;\n  }\n  function readInstrText(element) {\n    currentInstrText.push(element.text());\n    return emptyResult();\n  }\n  function readSymbol(element) {\n    // See 17.3.3.30 sym (Symbol Character) of ECMA-376 4th edition Part 1\n    var font = element.attributes[\"w:font\"];\n    var char = element.attributes[\"w:char\"];\n    var unicodeCharacter = dingbatToUnicode.hex(font, char);\n    if (unicodeCharacter == null && /^F0..$/.test(char)) {\n      unicodeCharacter = dingbatToUnicode.hex(font, char.substring(2));\n    }\n    if (unicodeCharacter == null) {\n      return emptyResultWithMessages([warning(\"A w:sym element with an unsupported character was ignored: char \" + char + \" in font \" + font)]);\n    } else {\n      return elementResult(new documents.Text(unicodeCharacter.string));\n    }\n  }\n  function noteReferenceReader(noteType) {\n    return function (element) {\n      var noteId = element.attributes[\"w:id\"];\n      return elementResult(new documents.NoteReference({\n        noteType: noteType,\n        noteId: noteId\n      }));\n    };\n  }\n  function readCommentReference(element) {\n    return elementResult(documents.commentReference({\n      commentId: element.attributes[\"w:id\"]\n    }));\n  }\n  function readChildElements(element) {\n    return readXmlElements(element.children);\n  }\n  var xmlElementReaders = {\n    \"w:p\": function (element) {\n      var paragraphPropertiesElement = element.firstOrEmpty(\"w:pPr\");\n      var isDeleted = !!paragraphPropertiesElement.firstOrEmpty(\"w:rPr\").first(\"w:del\");\n      if (isDeleted) {\n        element.children.forEach(function (child) {\n          deletedParagraphContents.push(child);\n        });\n        return emptyResult();\n      } else {\n        var childrenXml = element.children;\n        if (deletedParagraphContents.length > 0) {\n          childrenXml = deletedParagraphContents.concat(childrenXml);\n          deletedParagraphContents = [];\n        }\n        return ReadResult.map(readParagraphProperties(paragraphPropertiesElement), readXmlElements(childrenXml), function (properties, children) {\n          return new documents.Paragraph(children, properties);\n        }).insertExtra();\n      }\n    },\n    \"w:r\": function (element) {\n      return ReadResult.map(readRunProperties(element.firstOrEmpty(\"w:rPr\")), readXmlElements(element.children), function (properties, children) {\n        var hyperlinkOptions = currentHyperlinkOptions();\n        if (hyperlinkOptions !== null) {\n          children = [new documents.Hyperlink(children, hyperlinkOptions)];\n        }\n        return new documents.Run(children, properties);\n      });\n    },\n    \"w:fldChar\": readFldChar,\n    \"w:instrText\": readInstrText,\n    \"w:t\": function (element) {\n      return elementResult(new documents.Text(element.text()));\n    },\n    \"w:tab\": function (element) {\n      return elementResult(new documents.Tab());\n    },\n    \"w:noBreakHyphen\": function () {\n      return elementResult(new documents.Text(\"\\u2011\"));\n    },\n    \"w:softHyphen\": function (element) {\n      return elementResult(new documents.Text(\"\\u00AD\"));\n    },\n    \"w:sym\": readSymbol,\n    \"w:hyperlink\": function (element) {\n      var relationshipId = element.attributes[\"r:id\"];\n      var anchor = element.attributes[\"w:anchor\"];\n      return readXmlElements(element.children).map(function (children) {\n        function create(options) {\n          var targetFrame = element.attributes[\"w:tgtFrame\"] || null;\n          return new documents.Hyperlink(children, _.extend({\n            targetFrame: targetFrame\n          }, options));\n        }\n        if (relationshipId) {\n          var href = relationships.findTargetByRelationshipId(relationshipId);\n          if (anchor) {\n            href = uris.replaceFragment(href, anchor);\n          }\n          return create({\n            href: href\n          });\n        } else if (anchor) {\n          return create({\n            anchor: anchor\n          });\n        } else {\n          return children;\n        }\n      });\n    },\n    \"w:tbl\": readTable,\n    \"w:tr\": readTableRow,\n    \"w:tc\": readTableCell,\n    \"w:footnoteReference\": noteReferenceReader(\"footnote\"),\n    \"w:endnoteReference\": noteReferenceReader(\"endnote\"),\n    \"w:commentReference\": readCommentReference,\n    \"w:br\": function (element) {\n      var breakType = element.attributes[\"w:type\"];\n      if (breakType == null || breakType === \"textWrapping\") {\n        return elementResult(documents.lineBreak);\n      } else if (breakType === \"page\") {\n        return elementResult(documents.pageBreak);\n      } else if (breakType === \"column\") {\n        return elementResult(documents.columnBreak);\n      } else {\n        return emptyResultWithMessages([warning(\"Unsupported break type: \" + breakType)]);\n      }\n    },\n    \"w:bookmarkStart\": function (element) {\n      var name = element.attributes[\"w:name\"];\n      if (name === \"_GoBack\") {\n        return emptyResult();\n      } else {\n        return elementResult(new documents.BookmarkStart({\n          name: name\n        }));\n      }\n    },\n    \"mc:AlternateContent\": function (element) {\n      return readChildElements(element.first(\"mc:Fallback\"));\n    },\n    \"w:sdt\": function (element) {\n      return readXmlElements(element.firstOrEmpty(\"w:sdtContent\").children);\n    },\n    \"w:ins\": readChildElements,\n    \"w:object\": readChildElements,\n    \"w:smartTag\": readChildElements,\n    \"w:drawing\": readChildElements,\n    \"w:pict\": function (element) {\n      return readChildElements(element).toExtra();\n    },\n    \"v:roundrect\": readChildElements,\n    \"v:shape\": readChildElements,\n    \"v:textbox\": readChildElements,\n    \"w:txbxContent\": readChildElements,\n    \"wp:inline\": readDrawingElement,\n    \"wp:anchor\": readDrawingElement,\n    \"v:imagedata\": readImageData,\n    \"v:group\": readChildElements,\n    \"v:rect\": readChildElements\n  };\n  return {\n    readXmlElement: readXmlElement,\n    readXmlElements: readXmlElements\n  };\n  function readTable(element) {\n    var propertiesResult = readTableProperties(element.firstOrEmpty(\"w:tblPr\"));\n    return readXmlElements(element.children).flatMap(calculateRowSpans).flatMap(function (children) {\n      return propertiesResult.map(function (properties) {\n        return documents.Table(children, properties);\n      });\n    });\n  }\n  function readTableProperties(element) {\n    return readTableStyle(element).map(function (style) {\n      return {\n        styleId: style.styleId,\n        styleName: style.name\n      };\n    });\n  }\n  function readTableRow(element) {\n    var properties = element.firstOrEmpty(\"w:trPr\");\n    var isHeader = !!properties.first(\"w:tblHeader\");\n    return readXmlElements(element.children).map(function (children) {\n      return documents.TableRow(children, {\n        isHeader: isHeader\n      });\n    });\n  }\n  function readTableCell(element) {\n    return readXmlElements(element.children).map(function (children) {\n      var properties = element.firstOrEmpty(\"w:tcPr\");\n      var gridSpan = properties.firstOrEmpty(\"w:gridSpan\").attributes[\"w:val\"];\n      var colSpan = gridSpan ? parseInt(gridSpan, 10) : 1;\n      var cell = documents.TableCell(children, {\n        colSpan: colSpan\n      });\n      cell._vMerge = readVMerge(properties);\n      return cell;\n    });\n  }\n  function readVMerge(properties) {\n    var element = properties.first(\"w:vMerge\");\n    if (element) {\n      var val = element.attributes[\"w:val\"];\n      return val === \"continue\" || !val;\n    } else {\n      return null;\n    }\n  }\n  function calculateRowSpans(rows) {\n    var unexpectedNonRows = _.any(rows, function (row) {\n      return row.type !== documents.types.tableRow;\n    });\n    if (unexpectedNonRows) {\n      return elementResultWithMessages(rows, [warning(\"unexpected non-row element in table, cell merging may be incorrect\")]);\n    }\n    var unexpectedNonCells = _.any(rows, function (row) {\n      return _.any(row.children, function (cell) {\n        return cell.type !== documents.types.tableCell;\n      });\n    });\n    if (unexpectedNonCells) {\n      return elementResultWithMessages(rows, [warning(\"unexpected non-cell element in table row, cell merging may be incorrect\")]);\n    }\n    var columns = {};\n    rows.forEach(function (row) {\n      var cellIndex = 0;\n      row.children.forEach(function (cell) {\n        if (cell._vMerge && columns[cellIndex]) {\n          columns[cellIndex].rowSpan++;\n        } else {\n          columns[cellIndex] = cell;\n          cell._vMerge = false;\n        }\n        cellIndex += cell.colSpan;\n      });\n    });\n    rows.forEach(function (row) {\n      row.children = row.children.filter(function (cell) {\n        return !cell._vMerge;\n      });\n      row.children.forEach(function (cell) {\n        delete cell._vMerge;\n      });\n    });\n    return elementResult(rows);\n  }\n  function readDrawingElement(element) {\n    var blips = element.getElementsByTagName(\"a:graphic\").getElementsByTagName(\"a:graphicData\").getElementsByTagName(\"pic:pic\").getElementsByTagName(\"pic:blipFill\").getElementsByTagName(\"a:blip\");\n    return combineResults(blips.map(readBlip.bind(null, element)));\n  }\n  function readBlip(element, blip) {\n    var properties = element.first(\"wp:docPr\").attributes;\n    var altText = isBlank(properties.descr) ? properties.title : properties.descr;\n    var blipImageFile = findBlipImageFile(blip);\n    if (blipImageFile === null) {\n      return emptyResultWithMessages([warning(\"Could not find image file for a:blip element\")]);\n    } else {\n      return readImage(blipImageFile, altText);\n    }\n  }\n  function isBlank(value) {\n    return value == null || /^\\s*$/.test(value);\n  }\n  function findBlipImageFile(blip) {\n    var embedRelationshipId = blip.attributes[\"r:embed\"];\n    var linkRelationshipId = blip.attributes[\"r:link\"];\n    if (embedRelationshipId) {\n      return findEmbeddedImageFile(embedRelationshipId);\n    } else if (linkRelationshipId) {\n      var imagePath = relationships.findTargetByRelationshipId(linkRelationshipId);\n      return {\n        path: imagePath,\n        read: files.read.bind(files, imagePath)\n      };\n    } else {\n      return null;\n    }\n  }\n  function readImageData(element) {\n    var relationshipId = element.attributes['r:id'];\n    if (relationshipId) {\n      return readImage(findEmbeddedImageFile(relationshipId), element.attributes[\"o:title\"]);\n    } else {\n      return emptyResultWithMessages([warning(\"A v:imagedata element without a relationship ID was ignored\")]);\n    }\n  }\n  function findEmbeddedImageFile(relationshipId) {\n    var path = uris.uriToZipEntryName(\"word\", relationships.findTargetByRelationshipId(relationshipId));\n    return {\n      path: path,\n      read: docxFile.read.bind(docxFile, path)\n    };\n  }\n  function readImage(imageFile, altText) {\n    var contentType = contentTypes.findContentType(imageFile.path);\n    var image = documents.Image({\n      readImage: imageFile.read,\n      altText: altText,\n      contentType: contentType\n    });\n    var warnings = supportedImageTypes[contentType] ? [] : warning(\"Image of type \" + contentType + \" is unlikely to display in web browsers\");\n    return elementResultWithMessages(image, warnings);\n  }\n  function undefinedStyleWarning(type, styleId) {\n    return warning(type + \" style with ID \" + styleId + \" was referenced but not defined in the document\");\n  }\n}\nfunction readNumberingProperties(styleId, element, numbering) {\n  if (styleId != null) {\n    var levelByStyleId = numbering.findLevelByParagraphStyleId(styleId);\n    if (levelByStyleId != null) {\n      return levelByStyleId;\n    }\n  }\n  var level = element.firstOrEmpty(\"w:ilvl\").attributes[\"w:val\"];\n  var numId = element.firstOrEmpty(\"w:numId\").attributes[\"w:val\"];\n  if (level === undefined || numId === undefined) {\n    return null;\n  } else {\n    return numbering.findLevel(numId, level);\n  }\n}\nvar supportedImageTypes = {\n  \"image/png\": true,\n  \"image/gif\": true,\n  \"image/jpeg\": true,\n  \"image/svg+xml\": true,\n  \"image/tiff\": true\n};\nvar ignoreElements = {\n  \"office-word:wrap\": true,\n  \"v:shadow\": true,\n  \"v:shapetype\": true,\n  \"w:annotationRef\": true,\n  \"w:bookmarkEnd\": true,\n  \"w:sectPr\": true,\n  \"w:proofErr\": true,\n  \"w:lastRenderedPageBreak\": true,\n  \"w:commentRangeStart\": true,\n  \"w:commentRangeEnd\": true,\n  \"w:del\": true,\n  \"w:footnoteRef\": true,\n  \"w:endnoteRef\": true,\n  \"w:pPr\": true,\n  \"w:rPr\": true,\n  \"w:tblPr\": true,\n  \"w:tblGrid\": true,\n  \"w:trPr\": true,\n  \"w:tcPr\": true\n};\nfunction emptyResultWithMessages(messages) {\n  return new ReadResult(null, null, messages);\n}\nfunction emptyResult() {\n  return new ReadResult(null);\n}\nfunction elementResult(element) {\n  return new ReadResult(element);\n}\nfunction elementResultWithMessages(element, messages) {\n  return new ReadResult(element, null, messages);\n}\nfunction ReadResult(element, extra, messages) {\n  this.value = element || [];\n  this.extra = extra || [];\n  this._result = new Result({\n    element: this.value,\n    extra: extra\n  }, messages);\n  this.messages = this._result.messages;\n}\nReadResult.prototype.toExtra = function () {\n  return new ReadResult(null, joinElements(this.extra, this.value), this.messages);\n};\nReadResult.prototype.insertExtra = function () {\n  var extra = this.extra;\n  if (extra && extra.length) {\n    return new ReadResult(joinElements(this.value, extra), null, this.messages);\n  } else {\n    return this;\n  }\n};\nReadResult.prototype.map = function (func) {\n  var result = this._result.map(function (value) {\n    return func(value.element);\n  });\n  return new ReadResult(result.value, this.extra, result.messages);\n};\nReadResult.prototype.flatMap = function (func) {\n  var result = this._result.flatMap(function (value) {\n    return func(value.element)._result;\n  });\n  return new ReadResult(result.value.element, joinElements(this.extra, result.value.extra), result.messages);\n};\nReadResult.map = function (first, second, func) {\n  return new ReadResult(func(first.value, second.value), joinElements(first.extra, second.extra), first.messages.concat(second.messages));\n};\nfunction combineResults(results) {\n  var result = Result.combine(_.pluck(results, \"_result\"));\n  return new ReadResult(_.flatten(_.pluck(result.value, \"element\")), _.filter(_.flatten(_.pluck(result.value, \"extra\")), identity), result.messages);\n}\nfunction joinElements(first, second) {\n  return _.flatten([first, second]);\n}\nfunction identity(value) {\n  return value;\n}","map":{"version":3,"names":["exports","createBodyReader","_readNumberingProperties","readNumberingProperties","dingbatToUnicode","require","_","documents","Result","warning","uris","options","readXmlElement","element","BodyReader","readXmlElements","elements","complexFieldStack","currentInstrText","deletedParagraphContents","relationships","contentTypes","docxFile","files","numbering","styles","results","map","combineResults","type","handler","xmlElementReaders","name","Object","prototype","hasOwnProperty","call","ignoreElements","message","emptyResultWithMessages","emptyResult","readParagraphProperties","readParagraphStyle","style","styleId","styleName","alignment","firstOrEmpty","attributes","indent","readParagraphIndent","start","end","firstLine","hanging","readRunProperties","readRunStyle","fontSizeString","fontSize","test","parseInt","verticalAlignment","font","isBold","readBooleanElement","first","isUnderline","readUnderline","isItalic","isStrikethrough","isAllCaps","isSmallCaps","value","undefined","readStyle","findParagraphStyleById","findCharacterStyleById","readTableStyle","findTableStyleById","styleTagName","styleType","findStyleById","messages","styleElement","push","undefinedStyleWarning","elementResultWithMessages","unknownComplexField","readFldChar","pop","hyperlinkOptions","parseHyperlinkFieldCode","join","complexField","currentHyperlinkOptions","topHyperlink","last","filter","code","externalLinkResult","exec","href","internalLinkResult","anchor","readInstrText","text","readSymbol","char","unicodeCharacter","hex","substring","elementResult","Text","string","noteReferenceReader","noteType","noteId","NoteReference","readCommentReference","commentReference","commentId","readChildElements","children","w:p","paragraphPropertiesElement","isDeleted","forEach","child","childrenXml","length","concat","ReadResult","properties","Paragraph","insertExtra","w:r","Hyperlink","Run","w:t","w:tab","Tab","w:noBreakHyphen","w:softHyphen","w:hyperlink","relationshipId","create","targetFrame","extend","findTargetByRelationshipId","replaceFragment","readTable","readTableRow","readTableCell","w:br","breakType","lineBreak","pageBreak","columnBreak","w:bookmarkStart","BookmarkStart","mc:AlternateContent","w:sdt","w:pict","toExtra","readDrawingElement","readImageData","propertiesResult","readTableProperties","flatMap","calculateRowSpans","Table","isHeader","TableRow","gridSpan","colSpan","cell","TableCell","_vMerge","readVMerge","val","rows","unexpectedNonRows","any","row","types","tableRow","unexpectedNonCells","tableCell","columns","cellIndex","rowSpan","blips","getElementsByTagName","readBlip","bind","blip","altText","isBlank","descr","title","blipImageFile","findBlipImageFile","readImage","embedRelationshipId","linkRelationshipId","findEmbeddedImageFile","imagePath","path","read","uriToZipEntryName","imageFile","contentType","findContentType","image","Image","warnings","supportedImageTypes","levelByStyleId","findLevelByParagraphStyleId","level","numId","findLevel","extra","_result","joinElements","func","result","second","combine","pluck","flatten","identity"],"sources":["/Users/yashagrawal/Documents/Northwestern/Fall2023/CS338/InterviewPrep/node_modules/mammoth/lib/docx/body-reader.js"],"sourcesContent":["exports.createBodyReader = createBodyReader;\nexports._readNumberingProperties = readNumberingProperties;\n\nvar dingbatToUnicode = require(\"dingbat-to-unicode\");\nvar _ = require(\"underscore\");\n\nvar documents = require(\"../documents\");\nvar Result = require(\"../results\").Result;\nvar warning = require(\"../results\").warning;\nvar uris = require(\"./uris\");\n\nfunction createBodyReader(options) {\n    return {\n        readXmlElement: function(element) {\n            return new BodyReader(options).readXmlElement(element);\n        },\n        readXmlElements: function(elements) {\n            return new BodyReader(options).readXmlElements(elements);\n        }\n    };\n}\n\nfunction BodyReader(options) {\n    var complexFieldStack = [];\n    var currentInstrText = [];\n\n    // When a paragraph is marked as deleted, its contents should be combined\n    // with the following paragraph. See 17.13.5.15 del (Deleted Paragraph) of\n    // ECMA-376 4th edition Part 1.\n    var deletedParagraphContents = [];\n\n    var relationships = options.relationships;\n    var contentTypes = options.contentTypes;\n    var docxFile = options.docxFile;\n    var files = options.files;\n    var numbering = options.numbering;\n    var styles = options.styles;\n\n    function readXmlElements(elements) {\n        var results = elements.map(readXmlElement);\n        return combineResults(results);\n    }\n\n    function readXmlElement(element) {\n        if (element.type === \"element\") {\n            var handler = xmlElementReaders[element.name];\n            if (handler) {\n                return handler(element);\n            } else if (!Object.prototype.hasOwnProperty.call(ignoreElements, element.name)) {\n                var message = warning(\"An unrecognised element was ignored: \" + element.name);\n                return emptyResultWithMessages([message]);\n            }\n        }\n        return emptyResult();\n    }\n\n    function readParagraphProperties(element) {\n        return readParagraphStyle(element).map(function(style) {\n            return {\n                type: \"paragraphProperties\",\n                styleId: style.styleId,\n                styleName: style.name,\n                alignment: element.firstOrEmpty(\"w:jc\").attributes[\"w:val\"],\n                numbering: readNumberingProperties(style.styleId, element.firstOrEmpty(\"w:numPr\"), numbering),\n                indent: readParagraphIndent(element.firstOrEmpty(\"w:ind\"))\n            };\n        });\n    }\n\n    function readParagraphIndent(element) {\n        return {\n            start: element.attributes[\"w:start\"] || element.attributes[\"w:left\"],\n            end: element.attributes[\"w:end\"] || element.attributes[\"w:right\"],\n            firstLine: element.attributes[\"w:firstLine\"],\n            hanging: element.attributes[\"w:hanging\"]\n        };\n    }\n\n    function readRunProperties(element) {\n        return readRunStyle(element).map(function(style) {\n            var fontSizeString = element.firstOrEmpty(\"w:sz\").attributes[\"w:val\"];\n            // w:sz gives the font size in half points, so halve the value to get the size in points\n            var fontSize = /^[0-9]+$/.test(fontSizeString) ? parseInt(fontSizeString, 10) / 2 : null;\n\n            return {\n                type: \"runProperties\",\n                styleId: style.styleId,\n                styleName: style.name,\n                verticalAlignment: element.firstOrEmpty(\"w:vertAlign\").attributes[\"w:val\"],\n                font: element.firstOrEmpty(\"w:rFonts\").attributes[\"w:ascii\"],\n                fontSize: fontSize,\n                isBold: readBooleanElement(element.first(\"w:b\")),\n                isUnderline: readUnderline(element.first(\"w:u\")),\n                isItalic: readBooleanElement(element.first(\"w:i\")),\n                isStrikethrough: readBooleanElement(element.first(\"w:strike\")),\n                isAllCaps: readBooleanElement(element.first(\"w:caps\")),\n                isSmallCaps: readBooleanElement(element.first(\"w:smallCaps\"))\n            };\n        });\n    }\n\n    function readUnderline(element) {\n        if (element) {\n            var value = element.attributes[\"w:val\"];\n            return value !== undefined && value !== \"false\" && value !== \"0\" && value !== \"none\";\n        } else {\n            return false;\n        }\n    }\n\n    function readBooleanElement(element) {\n        if (element) {\n            var value = element.attributes[\"w:val\"];\n            return value !== \"false\" && value !== \"0\";\n        } else {\n            return false;\n        }\n    }\n\n    function readParagraphStyle(element) {\n        return readStyle(element, \"w:pStyle\", \"Paragraph\", styles.findParagraphStyleById);\n    }\n\n    function readRunStyle(element) {\n        return readStyle(element, \"w:rStyle\", \"Run\", styles.findCharacterStyleById);\n    }\n\n    function readTableStyle(element) {\n        return readStyle(element, \"w:tblStyle\", \"Table\", styles.findTableStyleById);\n    }\n\n    function readStyle(element, styleTagName, styleType, findStyleById) {\n        var messages = [];\n        var styleElement = element.first(styleTagName);\n        var styleId = null;\n        var name = null;\n        if (styleElement) {\n            styleId = styleElement.attributes[\"w:val\"];\n            if (styleId) {\n                var style = findStyleById(styleId);\n                if (style) {\n                    name = style.name;\n                } else {\n                    messages.push(undefinedStyleWarning(styleType, styleId));\n                }\n            }\n        }\n        return elementResultWithMessages({styleId: styleId, name: name}, messages);\n    }\n\n    var unknownComplexField = {type: \"unknown\"};\n\n    function readFldChar(element) {\n        var type = element.attributes[\"w:fldCharType\"];\n        if (type === \"begin\") {\n            complexFieldStack.push(unknownComplexField);\n            currentInstrText = [];\n        } else if (type === \"end\") {\n            complexFieldStack.pop();\n        } else if (type === \"separate\") {\n            var hyperlinkOptions = parseHyperlinkFieldCode(currentInstrText.join(''));\n            var complexField = hyperlinkOptions === null ? unknownComplexField : {type: \"hyperlink\", options: hyperlinkOptions};\n            complexFieldStack.pop();\n            complexFieldStack.push(complexField);\n        }\n        return emptyResult();\n    }\n\n    function currentHyperlinkOptions() {\n        var topHyperlink = _.last(complexFieldStack.filter(function(complexField) {\n            return complexField.type === \"hyperlink\";\n        }));\n        return topHyperlink ? topHyperlink.options : null;\n    }\n\n    function parseHyperlinkFieldCode(code) {\n        var externalLinkResult = /\\s*HYPERLINK \"(.*)\"/.exec(code);\n        if (externalLinkResult) {\n            return {href: externalLinkResult[1]};\n        }\n\n        var internalLinkResult = /\\s*HYPERLINK\\s+\\\\l\\s+\"(.*)\"/.exec(code);\n        if (internalLinkResult) {\n            return {anchor: internalLinkResult[1]};\n        }\n\n        return null;\n    }\n\n    function readInstrText(element) {\n        currentInstrText.push(element.text());\n        return emptyResult();\n    }\n\n    function readSymbol(element) {\n        // See 17.3.3.30 sym (Symbol Character) of ECMA-376 4th edition Part 1\n        var font = element.attributes[\"w:font\"];\n        var char = element.attributes[\"w:char\"];\n        var unicodeCharacter = dingbatToUnicode.hex(font, char);\n        if (unicodeCharacter == null && /^F0..$/.test(char)) {\n            unicodeCharacter = dingbatToUnicode.hex(font, char.substring(2));\n        }\n\n        if (unicodeCharacter == null) {\n            return emptyResultWithMessages([warning(\n                \"A w:sym element with an unsupported character was ignored: char \" +  char + \" in font \" + font\n            )]);\n        } else {\n            return elementResult(new documents.Text(unicodeCharacter.string));\n        }\n    }\n\n    function noteReferenceReader(noteType) {\n        return function(element) {\n            var noteId = element.attributes[\"w:id\"];\n            return elementResult(new documents.NoteReference({\n                noteType: noteType,\n                noteId: noteId\n            }));\n        };\n    }\n\n    function readCommentReference(element) {\n        return elementResult(documents.commentReference({\n            commentId: element.attributes[\"w:id\"]\n        }));\n    }\n\n    function readChildElements(element) {\n        return readXmlElements(element.children);\n    }\n\n    var xmlElementReaders = {\n        \"w:p\": function(element) {\n            var paragraphPropertiesElement = element.firstOrEmpty(\"w:pPr\");\n\n            var isDeleted = !!paragraphPropertiesElement\n                .firstOrEmpty(\"w:rPr\")\n                .first(\"w:del\");\n\n            if (isDeleted) {\n                element.children.forEach(function(child) {\n                    deletedParagraphContents.push(child);\n                });\n                return emptyResult();\n            } else {\n                var childrenXml = element.children;\n                if (deletedParagraphContents.length > 0) {\n                    childrenXml = deletedParagraphContents.concat(childrenXml);\n                    deletedParagraphContents = [];\n                }\n                return ReadResult.map(\n                    readParagraphProperties(paragraphPropertiesElement),\n                    readXmlElements(childrenXml),\n                    function(properties, children) {\n                        return new documents.Paragraph(children, properties);\n                    }\n                ).insertExtra();\n            }\n        },\n        \"w:r\": function(element) {\n            return ReadResult.map(\n                readRunProperties(element.firstOrEmpty(\"w:rPr\")),\n                readXmlElements(element.children),\n                function(properties, children) {\n                    var hyperlinkOptions = currentHyperlinkOptions();\n                    if (hyperlinkOptions !== null) {\n                        children = [new documents.Hyperlink(children, hyperlinkOptions)];\n                    }\n\n                    return new documents.Run(children, properties);\n                }\n            );\n        },\n        \"w:fldChar\": readFldChar,\n        \"w:instrText\": readInstrText,\n        \"w:t\": function(element) {\n            return elementResult(new documents.Text(element.text()));\n        },\n        \"w:tab\": function(element) {\n            return elementResult(new documents.Tab());\n        },\n        \"w:noBreakHyphen\": function() {\n            return elementResult(new documents.Text(\"\\u2011\"));\n        },\n        \"w:softHyphen\": function(element) {\n            return elementResult(new documents.Text(\"\\u00AD\"));\n        },\n        \"w:sym\": readSymbol,\n        \"w:hyperlink\": function(element) {\n            var relationshipId = element.attributes[\"r:id\"];\n            var anchor = element.attributes[\"w:anchor\"];\n            return readXmlElements(element.children).map(function(children) {\n                function create(options) {\n                    var targetFrame = element.attributes[\"w:tgtFrame\"] || null;\n\n                    return new documents.Hyperlink(\n                        children,\n                        _.extend({targetFrame: targetFrame}, options)\n                    );\n                }\n\n                if (relationshipId) {\n                    var href = relationships.findTargetByRelationshipId(relationshipId);\n                    if (anchor) {\n                        href = uris.replaceFragment(href, anchor);\n                    }\n                    return create({href: href});\n                } else if (anchor) {\n                    return create({anchor: anchor});\n                } else {\n                    return children;\n                }\n            });\n        },\n        \"w:tbl\": readTable,\n        \"w:tr\": readTableRow,\n        \"w:tc\": readTableCell,\n        \"w:footnoteReference\": noteReferenceReader(\"footnote\"),\n        \"w:endnoteReference\": noteReferenceReader(\"endnote\"),\n        \"w:commentReference\": readCommentReference,\n        \"w:br\": function(element) {\n            var breakType = element.attributes[\"w:type\"];\n            if (breakType == null || breakType === \"textWrapping\") {\n                return elementResult(documents.lineBreak);\n            } else if (breakType === \"page\") {\n                return elementResult(documents.pageBreak);\n            } else if (breakType === \"column\") {\n                return elementResult(documents.columnBreak);\n            } else {\n                return emptyResultWithMessages([warning(\"Unsupported break type: \" + breakType)]);\n            }\n        },\n        \"w:bookmarkStart\": function(element){\n            var name = element.attributes[\"w:name\"];\n            if (name === \"_GoBack\") {\n                return emptyResult();\n            } else {\n                return elementResult(new documents.BookmarkStart({name: name}));\n            }\n        },\n\n        \"mc:AlternateContent\": function(element) {\n            return readChildElements(element.first(\"mc:Fallback\"));\n        },\n\n        \"w:sdt\": function(element) {\n            return readXmlElements(element.firstOrEmpty(\"w:sdtContent\").children);\n        },\n\n        \"w:ins\": readChildElements,\n        \"w:object\": readChildElements,\n        \"w:smartTag\": readChildElements,\n        \"w:drawing\": readChildElements,\n        \"w:pict\": function(element) {\n            return readChildElements(element).toExtra();\n        },\n        \"v:roundrect\": readChildElements,\n        \"v:shape\": readChildElements,\n        \"v:textbox\": readChildElements,\n        \"w:txbxContent\": readChildElements,\n        \"wp:inline\": readDrawingElement,\n        \"wp:anchor\": readDrawingElement,\n        \"v:imagedata\": readImageData,\n        \"v:group\": readChildElements,\n        \"v:rect\": readChildElements\n    };\n\n    return {\n        readXmlElement: readXmlElement,\n        readXmlElements: readXmlElements\n    };\n\n\n    function readTable(element) {\n        var propertiesResult = readTableProperties(element.firstOrEmpty(\"w:tblPr\"));\n        return readXmlElements(element.children)\n            .flatMap(calculateRowSpans)\n            .flatMap(function(children) {\n                return propertiesResult.map(function(properties) {\n                    return documents.Table(children, properties);\n                });\n            });\n    }\n\n    function readTableProperties(element) {\n        return readTableStyle(element).map(function(style) {\n            return {\n                styleId: style.styleId,\n                styleName: style.name\n            };\n        });\n    }\n\n    function readTableRow(element) {\n        var properties = element.firstOrEmpty(\"w:trPr\");\n        var isHeader = !!properties.first(\"w:tblHeader\");\n        return readXmlElements(element.children).map(function(children) {\n            return documents.TableRow(children, {isHeader: isHeader});\n        });\n    }\n\n    function readTableCell(element) {\n        return readXmlElements(element.children).map(function(children) {\n            var properties = element.firstOrEmpty(\"w:tcPr\");\n\n            var gridSpan = properties.firstOrEmpty(\"w:gridSpan\").attributes[\"w:val\"];\n            var colSpan = gridSpan ? parseInt(gridSpan, 10) : 1;\n\n            var cell = documents.TableCell(children, {colSpan: colSpan});\n            cell._vMerge = readVMerge(properties);\n            return cell;\n        });\n    }\n\n    function readVMerge(properties) {\n        var element = properties.first(\"w:vMerge\");\n        if (element) {\n            var val = element.attributes[\"w:val\"];\n            return val === \"continue\" || !val;\n        } else {\n            return null;\n        }\n    }\n\n    function calculateRowSpans(rows) {\n        var unexpectedNonRows = _.any(rows, function(row) {\n            return row.type !== documents.types.tableRow;\n        });\n        if (unexpectedNonRows) {\n            return elementResultWithMessages(rows, [warning(\n                \"unexpected non-row element in table, cell merging may be incorrect\"\n            )]);\n        }\n        var unexpectedNonCells = _.any(rows, function(row) {\n            return _.any(row.children, function(cell) {\n                return cell.type !== documents.types.tableCell;\n            });\n        });\n        if (unexpectedNonCells) {\n            return elementResultWithMessages(rows, [warning(\n                \"unexpected non-cell element in table row, cell merging may be incorrect\"\n            )]);\n        }\n\n        var columns = {};\n\n        rows.forEach(function(row) {\n            var cellIndex = 0;\n            row.children.forEach(function(cell) {\n                if (cell._vMerge && columns[cellIndex]) {\n                    columns[cellIndex].rowSpan++;\n                } else {\n                    columns[cellIndex] = cell;\n                    cell._vMerge = false;\n                }\n                cellIndex += cell.colSpan;\n            });\n        });\n\n        rows.forEach(function(row) {\n            row.children = row.children.filter(function(cell) {\n                return !cell._vMerge;\n            });\n            row.children.forEach(function(cell) {\n                delete cell._vMerge;\n            });\n        });\n\n        return elementResult(rows);\n    }\n\n    function readDrawingElement(element) {\n        var blips = element\n            .getElementsByTagName(\"a:graphic\")\n            .getElementsByTagName(\"a:graphicData\")\n            .getElementsByTagName(\"pic:pic\")\n            .getElementsByTagName(\"pic:blipFill\")\n            .getElementsByTagName(\"a:blip\");\n\n        return combineResults(blips.map(readBlip.bind(null, element)));\n    }\n\n    function readBlip(element, blip) {\n        var properties = element.first(\"wp:docPr\").attributes;\n        var altText = isBlank(properties.descr) ? properties.title : properties.descr;\n        var blipImageFile = findBlipImageFile(blip);\n        if (blipImageFile === null) {\n            return emptyResultWithMessages([warning(\"Could not find image file for a:blip element\")]);\n        } else {\n            return readImage(blipImageFile, altText);\n        }\n    }\n\n    function isBlank(value) {\n        return value == null || /^\\s*$/.test(value);\n    }\n\n    function findBlipImageFile(blip) {\n        var embedRelationshipId = blip.attributes[\"r:embed\"];\n        var linkRelationshipId = blip.attributes[\"r:link\"];\n        if (embedRelationshipId) {\n            return findEmbeddedImageFile(embedRelationshipId);\n        } else if (linkRelationshipId) {\n            var imagePath = relationships.findTargetByRelationshipId(linkRelationshipId);\n            return {\n                path: imagePath,\n                read: files.read.bind(files, imagePath)\n            };\n        } else {\n            return null;\n        }\n    }\n\n    function readImageData(element) {\n        var relationshipId = element.attributes['r:id'];\n\n        if (relationshipId) {\n            return readImage(\n                findEmbeddedImageFile(relationshipId),\n                element.attributes[\"o:title\"]);\n        } else {\n            return emptyResultWithMessages([warning(\"A v:imagedata element without a relationship ID was ignored\")]);\n        }\n    }\n\n    function findEmbeddedImageFile(relationshipId) {\n        var path = uris.uriToZipEntryName(\"word\", relationships.findTargetByRelationshipId(relationshipId));\n        return {\n            path: path,\n            read: docxFile.read.bind(docxFile, path)\n        };\n    }\n\n    function readImage(imageFile, altText) {\n        var contentType = contentTypes.findContentType(imageFile.path);\n\n        var image = documents.Image({\n            readImage: imageFile.read,\n            altText: altText,\n            contentType: contentType\n        });\n        var warnings = supportedImageTypes[contentType] ?\n            [] : warning(\"Image of type \" + contentType + \" is unlikely to display in web browsers\");\n        return elementResultWithMessages(image, warnings);\n    }\n\n    function undefinedStyleWarning(type, styleId) {\n        return warning(\n            type + \" style with ID \" + styleId + \" was referenced but not defined in the document\");\n    }\n}\n\n\nfunction readNumberingProperties(styleId, element, numbering) {\n    if (styleId != null) {\n        var levelByStyleId = numbering.findLevelByParagraphStyleId(styleId);\n        if (levelByStyleId != null) {\n            return levelByStyleId;\n        }\n    }\n\n    var level = element.firstOrEmpty(\"w:ilvl\").attributes[\"w:val\"];\n    var numId = element.firstOrEmpty(\"w:numId\").attributes[\"w:val\"];\n    if (level === undefined || numId === undefined) {\n        return null;\n    } else {\n        return numbering.findLevel(numId, level);\n    }\n}\n\nvar supportedImageTypes = {\n    \"image/png\": true,\n    \"image/gif\": true,\n    \"image/jpeg\": true,\n    \"image/svg+xml\": true,\n    \"image/tiff\": true\n};\n\nvar ignoreElements = {\n    \"office-word:wrap\": true,\n    \"v:shadow\": true,\n    \"v:shapetype\": true,\n    \"w:annotationRef\": true,\n    \"w:bookmarkEnd\": true,\n    \"w:sectPr\": true,\n    \"w:proofErr\": true,\n    \"w:lastRenderedPageBreak\": true,\n    \"w:commentRangeStart\": true,\n    \"w:commentRangeEnd\": true,\n    \"w:del\": true,\n    \"w:footnoteRef\": true,\n    \"w:endnoteRef\": true,\n    \"w:pPr\": true,\n    \"w:rPr\": true,\n    \"w:tblPr\": true,\n    \"w:tblGrid\": true,\n    \"w:trPr\": true,\n    \"w:tcPr\": true\n};\n\nfunction emptyResultWithMessages(messages) {\n    return new ReadResult(null, null, messages);\n}\n\nfunction emptyResult() {\n    return new ReadResult(null);\n}\n\nfunction elementResult(element) {\n    return new ReadResult(element);\n}\n\nfunction elementResultWithMessages(element, messages) {\n    return new ReadResult(element, null, messages);\n}\n\nfunction ReadResult(element, extra, messages) {\n    this.value = element || [];\n    this.extra = extra || [];\n    this._result = new Result({\n        element: this.value,\n        extra: extra\n    }, messages);\n    this.messages = this._result.messages;\n}\n\nReadResult.prototype.toExtra = function() {\n    return new ReadResult(null, joinElements(this.extra, this.value), this.messages);\n};\n\nReadResult.prototype.insertExtra = function() {\n    var extra = this.extra;\n    if (extra && extra.length) {\n        return new ReadResult(joinElements(this.value, extra), null, this.messages);\n    } else {\n        return this;\n    }\n};\n\nReadResult.prototype.map = function(func) {\n    var result = this._result.map(function(value) {\n        return func(value.element);\n    });\n    return new ReadResult(result.value, this.extra, result.messages);\n};\n\nReadResult.prototype.flatMap = function(func) {\n    var result = this._result.flatMap(function(value) {\n        return func(value.element)._result;\n    });\n    return new ReadResult(result.value.element, joinElements(this.extra, result.value.extra), result.messages);\n};\n\nReadResult.map = function(first, second, func) {\n    return new ReadResult(\n        func(first.value, second.value),\n        joinElements(first.extra, second.extra),\n        first.messages.concat(second.messages)\n    );\n};\n\nfunction combineResults(results) {\n    var result = Result.combine(_.pluck(results, \"_result\"));\n    return new ReadResult(\n        _.flatten(_.pluck(result.value, \"element\")),\n        _.filter(_.flatten(_.pluck(result.value, \"extra\")), identity),\n        result.messages\n    );\n}\n\nfunction joinElements(first, second) {\n    return _.flatten([first, second]);\n}\n\nfunction identity(value) {\n    return value;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}